<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/mypage.css">
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-regular-straight/css/uicons-regular-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>

</head>
<body>
    <header>
        <h1>D.O.</h1>
    </header>
    <div id="layout">
        <nav>
            <div>
                <ul>
                    <a href="main.html" style="text-decoration: none; color: black;"><li><i class="fi fi-rs-home"></i>홈</li></a>
                    <li id="this"><i class="fi fi-rr-book-bookmark"></i>미션</li>
                    <li><i class="fi fi-rr-user"></i></i>마이페이지</li>
                </ul>
            </div>
            <div id="profile">
                <div>
                    <span>대소마고</span>
                    <small>@daegusomago2025</small>
                </div>
                <button id="logout">로그아웃</button>
            </div>
        </nav>
        <main>
            <div class="content-wr">
                <div class="profile-content" style="position: relative;">
                    <img src="../image/profile-img.png" style="width: 50px; height: 50px; border-radius: 50%; float: left;">
                    <div style="width: 30%; height: 100%; display: flex; flex-direction: column; margin: 10px; margin-left: 60px;">
                        <h4 style="display: inline-block;">대소마고</h4>
                        <p style="color: #A9A9A9; display: inline-block;">@daegusomago2025</p>    
                    </div>
                    <span style="font-size: 10px; bottom: 20px; right: 30px; position: absolute;">로그아웃</span>
                </div>

                <div class="main-wr" style="display: flex; gap: 30px; justify-content: space-between;">
                    <div class="main mainbox-left" style="width: 40%;">
                        <div class="mainbox-left_top br-20" style="padding: 8px; padding-left: 40px;">
                            <h3>지난 미션목록</h3>
                        </div>
                        <div class="mainbox-left_bottom br-20" style="border: none;">
                            <div class="container mt-5">
                                <ul class="list">
                                <li class="tab-button">맞춤 미션</li>
                                <li class="tab-button orange">만든 미션</li>
                                </ul>
                                <div class="tab-content-wr br-20" style="border-radius: 0 0 20px 20px ; border-top: 0px ;">
                                    <div class="tab-content show">
                                    </div>
                                    <div class="tab-content">
                                    </div>
                                </div>
                            </div> 
                        </div>
                    </div>
                    <div class="main mainbox-right br-20">
                        <div class="mainbox-right-" style="height: 350px;">
                            <div class="title-box">
                                <h5>진행중인 뱃지</h5>
                            </div>
                            <div style="width: 100%; height: 280px; display: flex; gap: 10px; justify-content: space-between; padding: 25px;">
                                
                                <div class="b-box">
                                    <div style="width: 80px; height: 80px; background-color: white;  margin: auto; margin-top: 20px; border-radius: 50%;">
                                        <img src="../image/2.png" class="c">

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;" class="API-name">이름</h5>
                                    <div style="display: flex;">
                                        <div style="margin-top: 10px;height: 7px; position: relative; width: 80%; background-color: #FFC6C6; border-radius: 20px;">
                                            <div class="progress" ></div>                                       
                                        </div>
                                        <span style="font-size: 8px; color: #F46666; float: right; margin-top: 10px; margin-left: 2px;">90%</span>
                                    </div>
                                    <div>
                                        <p class="si">설명</p>
                                    </div>
                                </div>
                                <div class="b-box">
                                    <div style="width: 80px; height: 80px; background-color: white;  margin: auto; margin-top: 20px; border-radius: 50%;">
                                        <img src="../image/4.png" class="c">

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;" class="API-name">이름</h5>
                                    <div style="display: flex;">
                                        <div style="margin-top: 10px;height: 7px; position: relative; width: 80%; background-color: #FFC6C6; border-radius: 20px;">
                                            <div class="progress" ></div>                                       
                                        </div>
                                        <span style="font-size: 8px; color: #F46666; float: right; margin-top: 10px; margin-left: 2px;">90%</span>
                                    </div>
                                    <div>
                                        <p class="si">설명</p>
                                    </div>
                                </div>
                                <div class="b-box">
                                    <div style="width: 80px; height: 80px; background-color: white;  margin: auto; margin-top: 20px; border-radius: 50%;">
                                        <img src="../image/5.png" class="c">

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;" class="API-name">이름</h5>
                                    <div style="display: flex;">
                                        <div style="margin-top: 10px;height: 7px; position: relative; width: 80%; background-color: #FFC6C6; border-radius: 20px;">
                                            <div class="progress" ></div>                                       
                                        </div>
                                        <span style="font-size: 8px; color: #F46666; float: right; margin-top: 10px; margin-left: 2px;">90%</span>
                                    </div>
                                    <div>
                                        <p class="si">설명</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mainbox-right-" style="border-top: solid 1px #E6D0D0; height: 350px;">
                            <div class="title-box">
                                <h5>총 뱃지</h5>
                            </div>
                            <div class="tkffuwnj">
                                <div class="seven-box">
                                      <div class="o-seven-box">
                                    <img src="../image/1.png" class="c2">
                                    <div style="width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); border-radius: 50%; position: absolute; top:0px"></div>

                                </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;" class="API-name">첫 도전자</h5>
                                </div>
                                <div class="seven-box">
                                    <div class="o-seven-box">
                                    <img src="../image/2.png" class="c2">
                                        <div style="width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); border-radius: 50%; position: absolute; top:0px"></div>

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;">꾸준한 도전자</h5>
                                </div>
                                <div class="seven-box">
                                    <div class="o-seven-box">
                                    <img src="../image/4.png" class="c2">
                                        <div style="width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); border-radius: 50%; position: absolute; top:0px"></div>

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;">도전 마스터</h5>
                                </div>
                                <div class="seven-box">
                                    <div class="o-seven-box">
                                    <img src="../image/5.png" class="c2">
                                        <div style="width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); border-radius: 50%; position: absolute; top:0px"></div>

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;">한계를 넘은 자</h5>

                                </div>
                                <div class="seven-box">
                                    <div class="o-seven-box">
                                    <img src="../image/7.png" class="c2">
                                        <div style="width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); border-radius: 50%; position: absolute; top:0px"></div>

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;">챌린지 리더</h5>

                                </div>
                                <div class="seven-box">
                                    <div class="o-seven-box">
                                        <div style="width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); border-radius: 50%; top:0px; position: relative;"></div>
                                        <h4 class="h4-">??</h4>

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;">미래 개척자</h5>

                                </div>
                                <div class="seven-box">
                                    <div class="o-seven-box">

                                        <div style="width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); border-radius: 50%; top:0px; position: relative;"></div>
                                        <h4 class="h4-">??</h4>

                                    </div>
                                    <h5 style="display: block;font-weight: bold; margin-top: 10px; text-align: center;">불굴의 탐험가</h5>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
        const token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJkb0BkZ3N3LmhzLmtyIiwiaWF0IjoxNzU0MTY3Nzg0LCJleHAiOjE3NTQyMDM3ODQsInN1YiI6IjEiLCJwdXJwb3NlIjoiYWNjZXNzIn0.v5aYwVQi7IaDuw1H49PXWj39Cc96bB2zkhJXb5gGtB4";
        const apiUrl = "http://10.10.6.55:8080/missions/completed";

        fetch(apiUrl, {
            method: "GET",
            headers: {
            Authorization: "Bearer " + token,
            },
        })
            .then((res) => {
            if (!res.ok) throw new Error("API 호출 실패: " + res.status);
            return res.json();
            })
            .then((data) => {
            // 1) seven-box 뱃지 영역 처리 (최신순 정렬)
            const sortedData = data.data.sort(
                (a, b) => new Date(b.grantedAt) - new Date(a.grantedAt)
            );
            const sevenBoxes = document.querySelectorAll(".seven-box");
            sevenBoxes.forEach((box, index) => {
                const item = sortedData[index];
                if (!item) return;

                const h5 = box.querySelector("h5");
                if (!h5) return;

                h5.innerHTML = item.title || item.content || "뱃지";

                const overlay = box.querySelector(".o-seven-box > div");
                if (overlay && h5.innerHTML === (item.title || item.content)) {
                overlay.classList.add("none"); // 오버레이 숨김
                } else if (overlay) {
                overlay.classList.remove("none"); // 오버레이 보임
                }
            });

            // 2) progress 상위 3개 표시 (achieved = true 필터)
            const top3 = data.data
                .filter((item) => item.achieved)
                .sort((a, b) => b.progress - a.progress)
                .slice(0, 3);
            const boxes = document.querySelectorAll(".b-box");
            top3.forEach((item, i) => {
                if (boxes[i]) {
                boxes[i].querySelector("h5.API-name").textContent = item.title;
                boxes[i].querySelector(".progress").style.width = item.progress + "%";
                boxes[i].querySelector("span").textContent = item.progress + "%";
                boxes[i].querySelector("p.si").textContent = item.description;
                }
            });

            // 3) 맞춤미션 / 만든미션 탭 컨텐츠 처리 (status IN_PROGRESS 필터)
            const missions = data.data.filter((item) => item.status === "IN_PROGRESS");
            const customMissionDiv = document.querySelectorAll(".tab-content")[0];
            const userMissionDiv = document.querySelectorAll(".tab-content")[1];

            customMissionDiv.innerHTML = "";
            userMissionDiv.innerHTML = "";

            missions.forEach((mission) => {
                const missionDiv = document.createElement("div");
                missionDiv.style.padding = "10px";
                missionDiv.style.borderBottom = "1px solid #ddd";
                missionDiv.innerHTML = `
                <p style="margin:0;"><strong>내용:</strong> ${mission.content}</p>
                <p style="margin:0; font-size: 12px; color: #666;"><strong>레벨:</strong> ${mission.level}</p>
                `;
                if (mission.aiGenerated) {
                customMissionDiv.appendChild(missionDiv);
                } else {
                userMissionDiv.appendChild(missionDiv);
                }
            });

            console.log("✅ 데이터 로드 성공");
            })
            .catch((err) => {
            console.error("API 호출 실패:", err);
            alert("데이터를 불러오는 데 실패했습니다.");
            });

        // 4) 탭 버튼 클릭 시 탭 전환 처리
        const tabButtons = document.querySelectorAll(".tab-button");
        const tabContents = document.querySelectorAll(".tab-content");

        tabButtons.forEach((btn, idx) => {
            btn.addEventListener("click", () => {
            tabButtons.forEach((b) => b.classList.remove("orange"));
            btn.classList.add("orange");

            tabContents.forEach((tc) => tc.classList.remove("show"));
            tabContents[idx].classList.add("show");
            });
        });
        });

    </script>

        
</body>
</html>